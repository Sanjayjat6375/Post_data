<% layout('/layouts/boilerplate.ejs') %>

    <div class="md:w-70% w-full">
        <div class="container mx-auto px-4 py-8">
            <div class="bg-white md:w-1/2 w-full mx-auto p-8 rounded-lg shadow-md">
                <h3 class="text-2xl font-bold mb-6">Edit listing:</h3>
                <div>
                    <form action="/listings/<%= listing._id %>?_method=PUT" enctype="multipart/form-data"
                        onsubmit="return validateForm()" method="POST">
                        <div class="mb-4">
                            <label for="title" class="block text-gray-700 font-semibold mb-2">Title</label>
                            <input type="text" name="title" id="title" value="<%= listing.title %>"
                                class="w-full px-3 hidden py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <p id="errTitle" class="text-red-500 mt-2 hidden">Please enter a title.</p>
                        </div>
                        <div class="mb-4">
                            <label for="description" class="block text-gray-700 font-semibold mb-2">Description</label>
                            <input type="text" name="description" id="description" value="<%= listing.description %>"
                                class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <p id="errDescription" class="text-red-500 mt-2 hidden">Please enter a description.</p>
                        </div>
                        <div class="mb-4">
                            <label for="image" class="block text-gray-700 font-semibold mb-2">Upload New Image</label>
                            <input type="file" name="listing[image]" id="image"
                                class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="py-2">
                            <h3>Original Image </h3>
                            <img class="w-1/2 hover:bg-white hover:opacity-[0.7]	h-48 md:h-72 object-cover rounded-t-lg"
                                src="<%= listing.image.url %>" alt="Card image cap">
                        </div>
                        <div class="mb-4">
                            <label for="price" class="block text-gray-700 font-semibold mb-2">Price</label>
                            <input type="text" name="price" id="price" value="<%= listing.price %>"
                                class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <p id="errPrice" class="text-red-500 mt-2 hidden">Please enter a valid price.</p>
                        </div>
                        <div class="mb-4">
                            <label for="location" class="block text-gray-700 font-semibold mb-2">Location</label>
                            <input type="text" name="location" id="location" value="<%= listing.location %>"
                                class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <p id="errLocation" class="text-red-500 mt-2 hidden">Please enter a location.</p>
                        </div>
                        <div class="mb-4">
                            <label for="country" class="block text-gray-700 font-semibold mb-2">Country</label>
                            <input type="text" name="country" id="country" value="<%= listing.country %>"
                                class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <p id="errCountry" class="text-red-500 mt-2 hidden">Please enter a country.</p>
                        </div>
                        <div>
                            <button type="submit"
                                class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        const validateForm = () => {
            let isValid = true;

            const title = document.getElementById("title").value;
            const description = document.getElementById("description").value;
            const price = document.getElementById("price").value;
            const location = document.getElementById("location").value;
            const country = document.getElementById("country").value;

            if (title === "") {
                document.getElementById("errTitle").classList.remove("hidden");
                isValid = false;
            } else {
                document.getElementById("errTitle").classList.add("hidden");
            }

            if (description === "") {
                document.getElementById("errDescription").classList.remove("hidden");
                isValid = false;
            } else {
                document.getElementById("errDescription").classList.add("hidden");
            }

            if (price === "") {
                document.getElementById("errPrice").classList.remove("hidden");
                isValid = false;
            } else {
                document.getElementById("errPrice").classList.add("hidden");
            }

            if (location === "") {
                document.getElementById("errLocation").classList.remove("hidden");
                isValid = false;
            } else {
                document.getElementById("errLocation").classList.add("hidden");
            }

            if (country === "") {
                document.getElementById("errCountry").classList.remove("hidden");
                isValid = false;
            } else {
                document.getElementById("errCountry").classList.add("hidden");
            }

            return isValid;
        }
    </script>